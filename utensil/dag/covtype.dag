DAGS:
  BAYES_OPTIMIZATION:
    SUPPLIES:
      - MODEL_PARAM
      - STATE

    DEMANDS:
      LAST_STATE: { BAYES_OPTIMIZATION: STATE }
      NEW_SCORE: { MODEL_SCORE: TEST_SCORE }

    NODES:
      STATE:
        PARENTS: [LAST_STATE]
        TRIGGERED_BY: [SWITCHON, LAST_STATE]
        PROCESSES: STATE_UPDATE

      MODEL_PARAM:
        PARENTS: [NEW_SCORE, STATE]
        TRIGGERED_BY: [NEW_SCORE]
        PROCESSES:
          - PARAMETER_SEARCH:
              SEARCH_MAP:
                LEARNING_RATE:
                  EXPONENTIAL_BETWEEN: { LEFT: 0.001, RIGHT: 0.2 }
                MAX_DEPTH:
                  UNIFORM_BETWEEN: { LEFT: 1, RIGHT: 10, TYPE: INTEGER }
                N_ESTIMATORS:
                  UNIFORM_BETWEEN: { LEFT: 5, RIGHT: 201, TYPE: INTEGER }

  MODEL_SCORE:
    SUPPLIES:
      - TEST_SCORE
    DEMANDS:
        NEW_PARAM: { BAYES_OPTIMIZATION: MODEL_PARAM }
    NODES:
      TEST_SCORE:
        PARENTS: [TEST_DATA, TEST_DATA, TRAINED_MODEL]
        TRIGGERED_BY: [NEW_PARAM]
        EXPORT: PRINT
        PROCESSES:
          - SCORE:
              DATASET: TEST_DATA
              METHODS: ACCURACY

      TRAIN_SCORE:
        PARENTS: [TRAIN_DATA, TRAIN_DATA, TRAINED_MODEL]
        TRIGGERED_BY: [NEW_PARAM]
        EXPORT: PRINT
        PROCESSES:
          - SCORE:
              DATASET: TRAIN_DATA
              METHODS: ACCURACY

      RAW_MODEL:
        PARENTS: [NEW_PARAM]
        PROCESSES:
          - MAKE_MODEL:
              METHOD: XGBOOST_CLASSIFIER
      P0:
        PROCESSES:
          - LOAD_DATA:
              URL: /home/hychou/Disk/K/data/covtype.bz2
              FORMAT: SVMLIGHT
              TARGET: Cover_Type
              FEATURES:
                0: Elevation
                1: Aspect
          - FILTER_ROWS:
              FILTER_BY:
                TARGET: [1, 2]

      P1:
        PARENTS: [P0]
        PROCESSES:
          - GET_FEATURE: Elevation
          - LINEAR_NORMALIZE:
              UPPER: { FROM: MAX, TO: 1 }
              LOWER: { FROM: MIN, TO: 0 }
      P2:
        PARENTS: [P0]
        PROCESSES:
          - GET_FEATURE: Aspect
          - LINEAR_NORMALIZE:
              UPPER: { FROM: MAX, TO: 1 }
              LOWER: { FROM: MIN, TO: 0 }
      P3:
        PARENTS: [P1, P2]
        PROCESSES:
          - MERGE_FEATURES

      P4:
        PARENTS: [P0]
        PROCESSES:
          - GET_TARGET
          - CHANGE_TYPE_TO: INTEGER

      DATASET:
        PARENTS: [P4, P3]
        PROCESSES:
          - MAKE_DATASET
          - SAMPLING_ROWS:
              NUMBER: 1000
              STRATIFIED: True
              RETURN_REST: True

      TRAIN_DATA:
        PARENTS: [DATASET]
        PROCESSES:
          - GET_ITEM: SAMPLED

      TEST_DATA:
        PARENTS: [DATASET]
        PROCESSES:
          - GET_ITEM: REST

      TRAINED_MODEL:
        PARENTS: [RAW_MODEL, TRAIN_DATA]
        PROCESSES: TRAIN
