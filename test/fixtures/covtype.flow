FLOW:

  COUNTER:
    CALLERS: SWITCHON | TEST_SCORE
    SENDERS: COUNTER.V
    TASK:
      - DEFAULT: 0
      - ADD: 1
      - LESS_EQUAL: 2

  TERMINAL:
    CALLERS: COUNTER.C/False
    TASK: DUMMY
    END: True

  MODEL_PARAM:
    CALLERS: COUNTER.C/True=V
    TASK:
      RANDOM_PARAMETER_SEARCH:
        SEARCH_MAP:
          LEARNING_RATE:
            EXPONENTIAL_BETWEEN: { LEFT: 0.001, RIGHT: 0.2 }
          MAX_DEPTH:
            UNIFORM_BETWEEN: { LEFT: 1, RIGHT: 3, TYPE: INTEGER }
          N_ESTIMATORS:
            UNIFORM_BETWEEN: { LEFT: 5, RIGHT: 10, TYPE: INTEGER }

  RAW_MODEL:
    SENDERS: MODEL_PARAM
    TASK:
      - MAKE_MODEL:
          METHOD: XGBOOST_CLASSIFIER

  RAW_DATA:
    CALLERS: SWITCHON | COUNTER.C/True=V
    TASK:
      - LOAD_DATA:
          URL: https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/covtype.bz2
          DFORMAT: SVMLIGHT
          TARGET: Cover_Type
          FEATURES:
            0: Elevation
            1: Aspect
      - FILTER_ROWS:
          FILTER_BY:
            TARGET: [1, 2]

  FEATURE_ELEVATION:
    SENDERS:
      DATASET: RAW_DATA
    TASK:
      - GET_FEATURE: Elevation
      - LINEAR_NORMALIZE:
          UPPER: { FROM: MAX, TO: 1 }
          LOWER: { FROM: MIN, TO: 0 }

  FEATURE_ASPECT:
    SENDERS:
      DATASET: RAW_DATA
    TASK:
      - GET_FEATURE: Aspect
      - LINEAR_NORMALIZE:
          UPPER: { FROM: MAX, TO: 1 }
          LOWER: { FROM: MIN, TO: 0 }

  FEATURES:
    SENDERS:
      FEATURES:
        - FEATURE_ELEVATION
        - FEATURE_ASPECT
    TASK: MERGE_FEATURES

  TARGET:
    SENDERS:
      DATASET: RAW_DATA
    TASK:
      - GET_TARGET
      - CHANGE_TYPE_TO: INTEGER

  DATASET:
    SENDERS:
      TARGET: TARGET
      FEATURES: FEATURES
    TASK:
      - MAKE_DATASET
      - SAMPLING_ROWS:
          NUMBER: 10
          STRATIFIED: True
          RETURN_REST: True

  TRAIN_DATA:
    SENDERS: DATASET.SAMPLED
    TASK: DUMMY

  TEST_DATA:
    SENDERS: DATASET.REST
    TASK: DUMMY

  TRAINED_MODEL:
    SENDERS:
      MODEL: RAW_MODEL
      DATASET: TRAIN_DATA
    TASK: TRAIN

  TRAIN_SCORE:
    SENDERS:
      PREDICTION: TRAIN_DATA
      GROUND_TRUTH: TRAIN_DATA
      MODEL: TRAINED_MODEL
    EXPORT: PRINT
    TASK:
      - SCORE:
          DATASET: TRAIN_DATA
          METHODS: ACCURACY

  TEST_SCORE:
    SENDERS:
      PREDICTION: TEST_DATA
      GROUND_TRUTH: TEST_DATA
      MODEL: TRAINED_MODEL
    EXPORT: [PRINT, RETURN]
    TASK:
      - SCORE:
          DATASET: TEST_DATA
          METHODS: ACCURACY
